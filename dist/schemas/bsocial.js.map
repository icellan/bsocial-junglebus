{"version":3,"file":"bsocial.js","names":["BObject","SimpleSchema","content","type","String","optional","length","Number","url","encoding","filename","BPPObject","action","currency","address","apiEndpoint","AIPObject","algorithm","bapId","signature","index","Array","verified","Boolean","BSOCIAL","Collection","block","Integer","label","timestamp","B","MAP","Object","blackbox","AIP","BPP","likes","reposts","comments","tips","payments","processed","after","doc","bSocialAfterInsert","updateOne","_id","$set","catch","e","console","error","reason","message"],"sources":["../../src/schemas/bsocial.js"],"sourcesContent":["import SimpleSchema from 'simpl-schema';\nimport { Collection } from '../lib/collection';\nimport { bSocialAfterInsert } from './hooks/bsocial-after-insert';\n\nconst BObject = new SimpleSchema({\n  content: {\n    type: String,\n    optional: true,\n  },\n  length: {\n    type: Number,\n    optional: true,\n  },\n  url: {\n    type: String,\n    optional: true,\n  },\n  'content-type': {\n    type: String,\n    optional: true,\n  },\n  encoding: {\n    type: String,\n    optional: true,\n  },\n  filename: {\n    type: String,\n    optional: true,\n  },\n});\n\nconst BPPObject = new SimpleSchema({\n  action: {\n    type: String,\n    optional: false,\n  },\n  currency: {\n    type: String,\n    optional: false,\n  },\n  address: {\n    type: String,\n    optional: false,\n  },\n  apiEndpoint: {\n    type: String,\n    optional: true,\n  },\n});\n\nconst AIPObject = new SimpleSchema({\n  algorithm: {\n    type: String,\n    optional: false,\n  },\n  address: {\n    type: String,\n    optional: false,\n  },\n  bapId: {\n    type: String,\n    optional: true,\n  },\n  signature: {\n    type: String,\n    optional: false,\n  },\n  index: {\n    type: Array,\n    optional: true,\n  },\n  'index.$': {\n    type: Number,\n  },\n  verified: {\n    type: Boolean,\n    optional: false,\n  },\n});\n\nexport const BSOCIAL = new Collection('bsocial', new SimpleSchema({\n  block: {\n    type: SimpleSchema.Integer,\n    label: 'Block number this transaction was mined into - null if still in mempool',\n    optional: true,\n  },\n  timestamp: {\n    type: SimpleSchema.Integer,\n    label: 'Timestamp this transaction was mined - null if still in mempool',\n    optional: true,\n  },\n  B: {\n    type: Array,\n    optional: true,\n  },\n  'B.$': {\n    type: BObject,\n  },\n  MAP: {\n    type: Array,\n    optional: false,\n  },\n  'MAP.$': {\n    type: Object,\n    blackbox: true,\n  },\n  AIP: {\n    type: Array,\n    optional: true,\n  },\n  'AIP.$': {\n    type: AIPObject,\n  },\n  BPP: {\n    type: Array,\n    optional: true,\n  },\n  'BPP.$': {\n    type: BPPObject,\n  },\n  likes: {\n    type: SimpleSchema.Integer,\n    optional: true,\n  },\n  reposts: {\n    type: SimpleSchema.Integer,\n    optional: true,\n  },\n  comments: {\n    type: SimpleSchema.Integer,\n    optional: true,\n  },\n  tips: {\n    type: SimpleSchema.Integer,\n    optional: true,\n  },\n  payments: {\n    type: SimpleSchema.Integer,\n    optional: true,\n  },\n  processed: {\n    type: Boolean,\n    optional: true,\n  },\n}));\n\n// all BSOCIAL inserts should be processed for stats\n// signing has been verified\nBSOCIAL.after('insert', async (doc) => {\n  // process likes, comments, reposts etc.\n  // update stats on context tx\n  await bSocialAfterInsert(doc);\n\n  await BSOCIAL.updateOne({\n    _id: doc._id,\n  }, {\n    $set: {\n      processed: true,\n    },\n  }).catch((e) => {\n    console.error('Failed updating BSocial processed', e.reason || e.message);\n  });\n});\n"],"mappings":"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"}